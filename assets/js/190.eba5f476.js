(window.webpackJsonp=window.webpackJsonp||[]).push([[190],{334:function(e,t,s){"use strict";s.r(t);var a=s(0),v=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"高级-7：reset-的本质——不止可以撤销提交"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#高级-7：reset-的本质——不止可以撤销提交","aria-hidden":"true"}},[e._v("#")]),e._v(" 高级 7：reset 的本质——不止可以撤销提交")]),s("p",[e._v("前面讲到，在最新的 "),s("code",[e._v("commit")]),e._v(" 写错时，可以用 "),s("code",[e._v("reset --hard")]),e._v(" 来把 "),s("code",[e._v("commit")]),e._v(" 撤销：")]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("git reset --hard HEAD^\n")])])]),s("blockquote",[s("p",[e._v("用这行代码可以撤销掉当前 "),s("code",[e._v("commit")])])]),s("p",[e._v("在这节里，就对 "),s("code",[e._v("reset")]),e._v(" 多说点，说说它的本质，说说它在撤销提交之外的用途。")]),s("h2",{attrs:{id:"reset-的本质：移动-head-以及它所指向的-branch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reset-的本质：移动-head-以及它所指向的-branch","aria-hidden":"true"}},[e._v("#")]),e._v(" reset 的本质：移动 HEAD 以及它所指向的 branch")]),s("p",[e._v("实质上，"),s("code",[e._v("reset")]),e._v(" 这个指令虽然可以用来撤销 "),s("code",[e._v("commit")]),e._v(" ，但它的实质行为并不是撤销，而是移动 "),s("code",[e._v("HEAD")]),e._v(" ，并且「捎带」上 "),s("code",[e._v("HEAD")]),e._v(" 所指向的 "),s("code",[e._v("branch")]),e._v("（如果有的话）。也就是说，"),s("code",[e._v("reset")]),e._v(' 这个指令的行为其实和它的字面意思 "reset"（重置）十分相符：它是用来重置 '),s("code",[e._v("HEAD")]),e._v(" 以及它所指向的 "),s("code",[e._v("branch")]),e._v(" 的位置的。")]),s("p",[e._v("而 "),s("code",[e._v("reset --hard HEAD^")]),e._v(" 之所以起到了撤销 "),s("code",[e._v("commit")]),e._v(" 的效果，是因为它把 "),s("code",[e._v("HEAD")]),e._v(" 和它所指向的 "),s("code",[e._v("branch")]),e._v(" 一起移动到了当前 "),s("code",[e._v("commit")]),e._v(" 的父 "),s("code",[e._v("commit")]),e._v(" 上，从而起到了「撤销」的效果：")]),s("p",[s("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2017/11/22/15fe19c8a3235853?w=466&h=262&f=gif&s=120940",alt:""}})]),s("blockquote",[s("p",[e._v("Git 的历史只能往回看，不能向未来看，所以把 "),s("code",[e._v("HEAD")]),e._v(" 和 "),s("code",[e._v("branch")]),e._v(" 往回移动，就能起到撤回 "),s("code",[e._v("commit")]),e._v(" 的效果。")])]),s("p",[e._v("所以同理，"),s("code",[e._v("reset --hard")]),e._v(" 不仅可以撤销提交，还可以用来把 "),s("code",[e._v("HEAD")]),e._v(" 和 "),s("code",[e._v("branch")]),e._v(" 移动到其他的任何地方。")]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("git reset --hard branch2\n")])])]),s("p",[s("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2017/11/22/15fe333cb605b0de?w=434&h=642&f=gif&s=154560",alt:""}})]),s("p",[e._v("不过……"),s("code",[e._v("reset")]),e._v(" 后面总是跟着的那个 "),s("code",[e._v("--hard")]),e._v(" 是什么意思呢？")]),s("p",[s("code",[e._v("reset")]),e._v(" 指令可以重置 "),s("code",[e._v("HEAD")]),e._v(" 和 "),s("code",[e._v("branch")]),e._v(" 的位置，不过在重置它们的同时，对工作目录可以选择不同的操作，而对工作目录的操作的不同，就是通过 "),s("code",[e._v("reset")]),e._v(" 后面跟的参数来确定的。")]),s("h2",{attrs:{id:"reset-hard：重置工作目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reset-hard：重置工作目录","aria-hidden":"true"}},[e._v("#")]),e._v(" reset --hard：重置工作目录")]),s("p",[s("code",[e._v("reset --hard")]),e._v(" 会在重置 "),s("code",[e._v("HEAD")]),e._v(" 和 "),s("code",[e._v("branch")]),e._v(" 的同时，重置工作目录里的内容。当你在 "),s("code",[e._v("reset")]),e._v(" 后面加了 "),s("code",[e._v("--hard")]),e._v(" 参数时，你的工作目录里的内容会被完全重置为和 "),s("code",[e._v("HEAD")]),e._v(" 的新位置相同的内容。换句话说，就是你的未提交的修改会被全部擦掉。")]),s("p",[e._v("例如你在上次 "),s("code",[e._v("commit")]),e._v(" 之后又对文件做了一些改动：")]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("git status\n")])])]),s("p",[s("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2017/11/22/15fe333cb5a0e894?w=621&h=236&f=jpeg&s=71681",alt:""}})]),s("p",[e._v("然后，你执行了 "),s("code",[e._v("reset")]),e._v(" 并附上了 "),s("code",[e._v("--hard")]),e._v(" 参数：")]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("git reset --hard HEAD^\n")])])]),s("p",[e._v("你的 "),s("code",[e._v("HEAD")]),e._v(" 和当前 "),s("code",[e._v("branch")]),e._v(" 切到上一条 "),s("code",[e._v("commit")]),e._v(" 的同时，你工作目录里的新改动也一起全都消失了，不管它们是否被放进暂存区：")]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("git status\n")])])]),s("p",[s("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2017/11/22/15fe333cb5dbef68?w=355&h=59&f=jpeg&s=20692",alt:""}})]),s("p",[e._v("可以看到，在 "),s("code",[e._v("reset --hard")]),e._v(" 后，所有的改动都被擦掉了。")]),s("h2",{attrs:{id:"reset-soft：保留工作目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reset-soft：保留工作目录","aria-hidden":"true"}},[e._v("#")]),e._v(" reset --soft：保留工作目录")]),s("p",[s("code",[e._v("reset --soft")]),e._v(" 会在重置 "),s("code",[e._v("HEAD")]),e._v(" 和 "),s("code",[e._v("branch")]),e._v(" 时，保留工作目录和暂存区中的内容，并把重置 "),s("code",[e._v("HEAD")]),e._v(" 所带来的新的差异放进暂存区。")]),s("p",[e._v("什么是「重置 "),s("code",[e._v("HEAD")]),e._v(" 所带来的新的差异」？就是这里：")]),s("p",[s("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2017/11/22/15fe333cb5c6a249?w=478&h=290&f=gif&s=202343",alt:""}})]),s("p",[e._v("由于 "),s("code",[e._v("HEAD")]),e._v(" 从 "),s("code",[e._v("4")]),e._v(" 移动到了 "),s("code",[e._v("3")]),e._v("，而且在 "),s("code",[e._v("reset")]),e._v(" 的过程中工作目录的内容没有被清理掉，所以 "),s("code",[e._v("4")]),e._v(" 中的改动在 "),s("code",[e._v("reset")]),e._v(" 后就也成了工作目录新增的「工作目录和 "),s("code",[e._v("HEAD")]),e._v(" 的差异」。这就是上面一段中所说的「重置 "),s("code",[e._v("HEAD")]),e._v(" 所带来的差异」。")]),s("p",[e._v("所以在同样的情况下：")]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("git status\n")])])]),s("p",[s("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2017/11/22/15fe333cb5a0e894?w=621&h=236&f=jpeg&s=71681",alt:""}})]),s("p",[e._v("假设此时当前 "),s("code",[e._v("commit")]),e._v(" 的改动内容是新增了 "),s("code",[e._v("laughters.txt")]),e._v(" 文件：")]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("git show --stat\n")])])]),s("p",[s("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2017/11/22/15fe333cb7cdd727?w=533&h=180&f=jpeg&s=47095",alt:""}})]),s("p",[e._v("如果这时你执行：")]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("git reset --soft HEAD^\n")])])]),s("p",[e._v("那么除了 "),s("code",[e._v("HEAD")]),e._v(" 和它所指向的 "),s("code",[e._v("branch1")]),e._v(" 被移动到 "),s("code",[e._v("HEAD^")]),e._v(" 之外，原先 "),s("code",[e._v("HEAD")]),e._v(" 处 "),s("code",[e._v("commit")]),e._v(" 的改动（也就是那个 "),s("code",[e._v("laughters.txt")]),e._v(" 文件）也会被放进暂存区：")]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("git status\n")])])]),s("p",[s("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2017/11/22/15fe333cb7e6e40b?w=626&h=278&f=jpeg&s=90747",alt:""}})]),s("p",[e._v("这就是 "),s("code",[e._v("--soft")]),e._v(" 和 "),s("code",[e._v("--hard")]),e._v(" 的区别："),s("code",[e._v("--hard")]),e._v(" 会清空工作目录的改动，而 "),s("code",[e._v("--soft")]),e._v(" 则会保留工作目录的内容，并把因为保留工作目录内容所带来的新的文件差异放进暂存区。")]),s("h2",{attrs:{id:"reset-不加参数：保留工作目录，并清空暂存区"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reset-不加参数：保留工作目录，并清空暂存区","aria-hidden":"true"}},[e._v("#")]),e._v(" reset 不加参数：保留工作目录，并清空暂存区")]),s("p",[s("code",[e._v("reset")]),e._v(" 如果不加参数，那么默认使用 "),s("code",[e._v("--mixed")]),e._v(" 参数。它的行为是：保留工作目录，并且清空暂存区。也就是说，工作目录的修改、暂存区的内容以及由 "),s("code",[e._v("reset")]),e._v(" 所导致的新的文件差异，都会被放进工作目录。简而言之，就是「把所有差异都混合（mixed）放在工作目录中」。")]),s("p",[e._v("还以同样的情况为例：")]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("git status\n")])])]),s("p",[s("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2017/11/22/15fe333cb5a0e894?w=621&h=236&f=jpeg&s=71681",alt:""}})]),s("blockquote",[s("p",[e._v("修改了 "),s("code",[e._v("games.txt")]),e._v(" 和 "),s("code",[e._v("shopping list.txt")]),e._v("，并把 "),s("code",[e._v("games.txt")]),e._v(" 放进了暂存区。")])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("git show --stat\n")])])]),s("p",[s("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2017/11/22/15fe333cb7cdd727?w=533&h=180&f=jpeg&s=47095",alt:""}})]),s("blockquote",[s("p",[e._v("最新的 "),s("code",[e._v("commit")]),e._v(" 中新增了 "),s("code",[e._v("laughters.txt")]),e._v(" 文件。")])]),s("p",[e._v("这时如果你执行无参数的 "),s("code",[e._v("reset")]),e._v("：")]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("git reset HEAD^\n")])])]),s("p",[e._v("工作目录的内容和 "),s("code",[e._v("--soft")]),e._v(" 一样会被保留，但和 "),s("code",[e._v("--soft")]),e._v(" 的区别在于，它会把暂存区清空：")]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("git status\n")])])]),s("p",[s("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2017/11/22/15fe333d086f9754?w=625&h=256&f=jpeg&s=70740",alt:""}})]),s("h2",{attrs:{id:"小结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#小结","aria-hidden":"true"}},[e._v("#")]),e._v(" 小结")]),s("p",[e._v("本节内容讲了 "),s("code",[e._v("reset")]),e._v(" 指令的本质：重置 "),s("code",[e._v("HEAD")]),e._v(" 以及它所指向的 "),s("code",[e._v("branch")]),e._v(" 的位置。同时，介绍了 "),s("code",[e._v("reset")]),e._v(" 的三种参数：")]),s("ol",[s("li",[s("code",[e._v("--hard")]),e._v("：重置位置的同时，清空工作目录的所有改动；")]),s("li",[s("code",[e._v("--soft")]),e._v("：重置位置的同时，保留工作目录和暂存区的内容，并把重置 "),s("code",[e._v("HEAD")]),e._v(" 的位置所导致的新的文件差异放进暂存区。")]),s("li",[s("code",[e._v("--mixed")]),e._v("（默认）：重置位置的同时，保留工作目录的内容，并清空暂存区。")])]),s("p",[e._v("除了上面这三种参数，还有一些没有列出的较为不常用的参数；另外除了我讲的功能外，"),s("code",[e._v("reset")]),e._v(" 其实也还有一些别的功能和用法。不过 "),s("code",[e._v("reset")]),e._v(" 最关键的功能、用法和本质原理就是上面这些了，想了解更多的话，可以去官网了解一下。")])])}],!1,null,null,null);t.default=v.exports}}]);