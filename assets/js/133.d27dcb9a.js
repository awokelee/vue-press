(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{249:function(t,s,n){"use strict";n.r(s);var a=n(0),e=Object(a.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[t._m(0),n("p",[n("a",{attrs:{href:"https://nodejs.org/en/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Node.js"),n("OutboundLink")],1),t._v(" 丰富的生态能赋予我们更强的能力，对于前端工程师来说，使用 Node.js 来编写复杂的 npm script 具有明显的 2 个优势：首先，编写简单的工具脚本对前端工程师来说额外的学习成本很低甚至可以忽略不计，其次，因为 Node.js 本身是跨平台的，用它编写的脚本出现跨平台兼容问题的概率很小。")]),n("p",[t._v("下面我们就一起探索下，如何把上节中使用 shell 编写的 cover 脚本改写成 Node.js 脚本，在 Node.js 脚本中我们也能体味到 "),n("a",{attrs:{href:"https://www.npmjs.com/package/shelljs",target:"_blank",rel:"noopener noreferrer"}},[t._v("shelljs"),n("OutboundLink")],1),t._v(" 这个工具包的强大。")]),t._m(1),n("p",[t._v("使用如下命令安装 shelljs 到项目依赖中：")]),t._m(2),n("p",[t._v("此外，我们计划使用 "),n("a",{attrs:{href:"https://www.npmjs.com/package/chalk",target:"_blank",rel:"noopener noreferrer"}},[t._v("chalk"),n("OutboundLink")],1),t._v(" 来给输出加点颜色，让脚本变的更有趣，同样安装到 devDependencies 里面：")]),t._m(3),t._m(4),t._m(5),t._m(6),n("p",[t._v("shelljs 为我们提供了各种常见命令的跨平台支持，比如 cp、mkdir、rm、cd 等命令，此外，理论上你可以在 Node.js 脚本中使用任何 "),n("a",{attrs:{href:"https://www.npmjs.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("npmjs.com"),n("OutboundLink")],1),t._v(" 上能找到的包。清理归档目录、运行测试、归档并预览覆盖率报告的完整 Node.js 代码如下：")]),t._m(7),n("p",[t._v("关于改动的几点说明：")]),t._m(8),t._m(9),n("p",[t._v("准备好 Node.js 脚本之后，我们需要修改 package.json 里面的命令，使其运行该脚本：")]),t._m(10),t._m(11),n("p",[t._v("重新运行 npm run cover 命令，不出意外的话，基本功能是正常的，除了我们新加的绿色输出，如下图：")]),t._m(12),n("p",[t._v("以上，本小节完，这里只是简单展示了如何组织 Node.js 脚本并且让其与 npm script 关联起来，至于具体在脚本中做什么事情，请你自由发挥吧。")]),n("hr"),n("blockquote",[n("p",[t._v("本节用到的代码见 "),n("a",{attrs:{href:"https://github.com/wangshijun/automated-workflow-with-npm-script/tree/08-using-nodejs-script-as-replacement",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub"),n("OutboundLink")],1),t._v("，想边看边动手练习的同学可以拉下来自己改，注意切换到正确的分支 "),n("code",[t._v("08-using-nodejs-script-as-replacement")]),t._v("。")])]),n("hr")])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"_3-3-用-node-js-脚本替代复杂的-npm-script"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-用-node-js-脚本替代复杂的-npm-script","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.3 用 node.js 脚本替代复杂的 npm script")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_1-安装-shelljs-依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装-shelljs-依赖","aria-hidden":"true"}},[this._v("#")]),this._v(" 1. 安装 shelljs 依赖")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" i shelljs -D\n"),s("span",{attrs:{class:"token comment"}},[this._v("# npm install shelljs --save-dev")]),this._v("\n"),s("span",{attrs:{class:"token comment"}},[this._v("# yarn add shelljs -D")]),this._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" i chalk -D\n"),s("span",{attrs:{class:"token comment"}},[this._v("# npm install chalk --save-dev")]),this._v("\n"),s("span",{attrs:{class:"token comment"}},[this._v("# yarn add chalk -D")]),this._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-创建-node-js-脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建-node-js-脚本","aria-hidden":"true"}},[this._v("#")]),this._v(" 2. 创建 Node.js 脚本")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("touch")]),this._v(" scripts/cover.js\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_3-用-node-js-实现同等功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-用-node-js-实现同等功能","aria-hidden":"true"}},[this._v("#")]),this._v(" 3. 用 Node.js 实现同等功能")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" rm"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cp"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mkdir"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exec"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" echo "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("require")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'shelljs'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" chalk "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("require")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'chalk'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("chalk"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("green")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'1. remove old coverage reports...'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token function"}},[t._v("rm")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'-rf'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'coverage'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token function"}},[t._v("rm")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'-rf'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'.nyc_output'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("chalk"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("green")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'2. run test and collect new coverage...'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token function"}},[t._v("exec")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'nyc --reporter=html npm run test'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("chalk"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("green")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'3. archive coverage report by version...'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token function"}},[t._v("mkdir")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'-p'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'coverage_archive/$npm_package_version'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token function"}},[t._v("cp")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'-r'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'coverage/*'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'coverage_archive/$npm_package_version'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("log")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("chalk"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("green")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'4. open coverage report for preview...'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token function"}},[t._v("exec")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'npm-run-all --parallel cover:serve cover:open'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("简单的文件系统操作，建议直接使用 shelljs 提供的 cp、rm 等替换；")]),s("li",[this._v("部分稍复杂的命令，比如 nyc 可以使用 exec 来执行，也可以使用 istanbul 包来完成；")]),s("li",[this._v("在 exec 中也可以大胆的使用 npm script 运行时的环境变量，比如 "),s("code",[this._v("$npm_package_version")]),this._v("；")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_4-让-package-json-指向新脚本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-让-package-json-指向新脚本","aria-hidden":"true"}},[this._v("#")]),this._v(" 4. 让 package.json 指向新脚本")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-patch extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v('   "scripts": {\n     "test": "cross-env NODE_ENV=test mocha tests/",\n-    "cover": "scripty",\n+    "cover": "node scripts/cover.js",\n     "cover:open": "scripty"\n   },\n')])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_5-测试-cover-命名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-测试-cover-命名","aria-hidden":"true"}},[this._v("#")]),this._v(" 5. 测试 cover 命名")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2017/12/10/1603de95af9b2c41?w=1060&h=587&f=png&s=87226",alt:""}})])}],!1,null,null,null);s.default=e.exports}}]);