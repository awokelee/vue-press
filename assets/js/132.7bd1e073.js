(window.webpackJsonp=window.webpackJsonp||[]).push([[132],{247:function(t,e,n){"use strict";n.r(e);var a=n(0),r=Object(a.a)({},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"content"},[t._m(0),n("p",[t._v("软件工程师做的事情基本都是在实现自动化，比如各种业务系统是为了业务运转的自动化，部署系统是为了运维的自动化，对于开发者本身，自动化也是提升效率的关键环节，在实际开发过程中也有不少事情是可以自动化的。")]),n("p",[t._v("拥抱现代前端工作流的同学都会有代码风格检查、单元测试等环节，这样就很需要在代码变更之后立即得到反馈，如代码改动导致了那个 Case 失败，哪块不符合团队的编码规范等。")]),n("p",[t._v("使用 gulp、grunt 的同学，可能对这种功能非常熟悉，不就是 watch 么？确实是，使用 npm script 我们也可以实现类似的功能。下面详细介绍如何改造我们的项目实现单测、代码检查的自动化。")]),t._m(1),t._m(2),t._m(3),n("p",[t._v("尝试运行 npm run watch:test，我们会发现进程并没有退出，接下来尝试去修改测试代码，测试是不是自动重跑了呢？自己试试看。")]),t._m(4),n("p",[t._v("我们使用的代码检查工具 "),n("a",{attrs:{href:"https://stylelint.io",target:"_blank",rel:"noopener noreferrer"}},[t._v("stylelint"),n("OutboundLink")],1),t._v("、"),n("a",{attrs:{href:"https://eslint.org",target:"_blank",rel:"noopener noreferrer"}},[t._v("eslint"),n("OutboundLink")],1),t._v("、"),n("a",{attrs:{href:"https://github.com/zaach/jsonlint",target:"_blank",rel:"noopener noreferrer"}},[t._v("jsonlint"),n("OutboundLink")],1),t._v(" 不全支持 watch 模式，这里我们需要借助 "),n("a",{attrs:{href:"https://github.com/Qard/onchange",target:"_blank",rel:"noopener noreferrer"}},[t._v("onchange"),n("OutboundLink")],1),t._v(" 工具包来实现，onchange 可以方便的让我们在文件被修改、添加、删除时运行需要的命令。")]),t._m(5),n("p",[t._v("使用如下命令安装 onchange 到项目依赖中：")]),t._m(6),t._m(7),n("p",[t._v("按照如下提示添加 watch:lint 和 watch 两个子命令：")]),t._m(8),n("p",[t._v("关于改动的几点说明：")]),t._m(9),n("blockquote",[n("p",[n("strong",[t._v("TIP#15")]),t._v("：有没有好奇过 onchange 是怎么实现文件系统监听的？所有的魔法都藏在它的源代码里面，实际上它使用了跨平台的文件系统监听包 "),n("a",{attrs:{href:"https://github.com/paulmillr/chokidar",target:"_blank",rel:"noopener noreferrer"}},[t._v("chokidar"),n("OutboundLink")],1),t._v("，基于它，你能做点什么有意思的事情呢？")])]),n("p",[t._v("onchange 有个不太醒目的特性是，文件系统发生变化之后，他在运行指定命令之前输出哪个文件发生了哪些变化，如下图红框中的内容：")]),t._m(10),n("p",[t._v("读到这里，有没有觉得 onchange 可以和 gulp、grunt 的 watch 一样强大。")]),t._m(11),n("hr"),n("blockquote",[n("p",[t._v("本节用到的代码见 "),n("a",{attrs:{href:"https://github.com/wangshijun/automated-workflow-with-npm-script/tree/09-run-npm-script-with-onchange",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub"),n("OutboundLink")],1),t._v("，想边看边动手练习的同学可以拉下来自己改，注意切换到正确的分支 "),n("code",[t._v("09-run-npm-script-with-onchange")]),t._v("。")])]),n("hr")])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"_4-1-文件变化时自动运行-npm-script"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-文件变化时自动运行-npm-script","aria-hidden":"true"}},[this._v("#")]),this._v(" 4.1 文件变化时自动运行 npm script")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"单元测试自动化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#单元测试自动化","aria-hidden":"true"}},[this._v("#")]),this._v(" 单元测试自动化")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("幸运的是，mocha 本身支持 "),e("code",[this._v("--watch")]),this._v(" 参数，即在代码变化时自动重跑所有的测试，我们只需要在 scripts 对象中新增一条命令即可：")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-patch extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('     "test": "cross-env NODE_ENV=test mocha tests/",\n+    "watch:test": "npm t -- --watch",\n     "cover": "node scripts/cover.js",\n')])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"代码检查自动化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#代码检查自动化","aria-hidden":"true"}},[this._v("#")]),this._v(" 代码检查自动化")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"_1-安装项目依赖"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装项目依赖","aria-hidden":"true"}},[this._v("#")]),this._v(" 1. 安装项目依赖")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{attrs:{class:"token function"}},[this._v("npm")]),this._v(" i onchange -D\n"),e("span",{attrs:{class:"token comment"}},[this._v("# npm install onchange --save-dev")]),this._v("\n"),e("span",{attrs:{class:"token comment"}},[this._v("# yarn add onchange -D")]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"_2-添加-npm-script"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-添加-npm-script","aria-hidden":"true"}},[this._v("#")]),this._v(" 2. 添加 npm script")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-patch extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v('+    "watch": "npm-run-all --parallel watch:*",\n+    "watch:lint": "onchange -i \\"**/*.js\\" \\"**/*.less\\" -- npm run lint",\n     "watch:test": "npm t -- --watch",\n')])])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",[n("li",[n("code",[t._v("watch:lint")]),t._v(" 里面的文件匹配模式可以使用通配符，但是模式两边使用了转义的双引号，这样是跨平台兼容的；")]),n("li",[n("code",[t._v("watch:lint")]),t._v(" 里面的 "),n("code",[t._v("-i")]),t._v(" 参数是让 onchange 在启动时就运行一次 "),n("code",[t._v("--")]),t._v(" 之后的命令，即代码没变化的时候，变化前后的对比大多数时候还是有价值的；")]),n("li",[t._v("watch 命令实际上是使用了 npm-run-all 来运行所有的 watch 子命令；")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:"https://user-gold-cdn.xitu.io/2017/12/12/160481d04f4e2aa5?w=951&h=533&f=png&s=77037",alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("除了上面的单测重跑和代码检查之外，你还有什么需求需要放在 onchange 里面？欢迎留言讨论。")])])}],!1,null,null,null);e.default=r.exports}}]);